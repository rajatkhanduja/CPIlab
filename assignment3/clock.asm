cpu "8085.tbl"
hof "int8"

org 8000h

;store current state
PUSH PSW
PUSH B
PUSH D
PUSH H

CALL CLOCK

POP H
POP D
POP B
POP PSW

RST 05

CLOCK: NOP
POP H
SHLD 8300H
;initialize 3 memory locations to hold HH, MM, SS
MVI A,00H
STA 8400H
STA 8401H
STA 8402H
;loop with delay to update the memory locations
CLOCKLOOP: NOP
;TODO:add delay here
CLOCKSS: NOP
LDA 8402H
INR A
CPI 3CH
JZ CLOCKADJUSTSS
CLOCKSS1: NOP
STA 8402H
CLOCKMM: NOP
LDA 8401H
ADD C
MVI C,00H
CPI 3CH
JZ CLOCKADJUSTMM
CLOCKMM1: NOP
STA 8401H
CLOCKHH: NOP
LDA 8400H
ADD C
MVI C,00H
STA 8400H
;call the subroutine to display updated memory locations
PUSH PSW
PUSH B
PUSH D
PUSH H
LHLD 8400H
PUSH H
LHLD 8402H
PUSH H
CALL CLOCKDISPLAY
POP H
POP D
POP B
POP PSW
LDA 8400H
CPI 18H
JZ CLOCKEXIT
J CLOCKLOOP
CLOCKEXIT: NOP
LHLD 8300H
PUSH H
RET
CLOCKADJUSTSS: NOP
MVI C,01H
MVI A,00H
J CLOCKSS1
CLOCKADJUSTMM: NOP
MVI C,01H
MVI A,00H
J CLOCKMM1
CLOCKDISPLAY: NOP
POP H
SHLD 8302H
POP H
;TODO:add code to display H on screen: SS
POP H
;TODO:add code to display L on screen: MM
;TODO:add code to display H on screen: HH
CLOCKDISPLAYEXIT: NOP
LHLD 8302H
PUSH H
RET

